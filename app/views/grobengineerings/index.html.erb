<h1>Grobengineering</h1>
<br>
<% if Assembly.validateEntries %>
  <% if Device.any? %>
      <% if @subsubproject.offertpositions.any? %>
          <% if !@grobengineerings.any? %>
              <h4>Import von CSV</h4>
              <%= form_tag import_project_subproject_subsubproject_grobengineerings_path, multipart: true do %>
                  <div class="actions form-group">
                    <%= file_field_tag :file, class: 'form-control' %><br>
                    <%= submit_tag "Import CSV", class: "btn btn-success" %>
                  </div>
              <% end %><br>
              <br><br>
          <% end %>
          <a href="<%= new_project_subproject_subsubproject_grobengineering_path %>" class="btn btn-success">Neuen Eintrag erstellen</a><br><br>
          <a href="<%=project_subproject_subsubproject_grobengineerings_path%>.csv" class="btn btn-default">CSV-Export</a>
          <a href="<%= delete_all_path(@subsubproject.subproject.project.id, @subsubproject.subproject.id, @subsubproject.id) %>"
             onclick="return confirm_click();"
             class="btn btn-danger">Alle Einträge löschen</a>
          <a href="<%= grobengineering_extended_path(@subsubproject.subproject.project.id, @subsubproject.subproject.id, @subsubproject.id) %>" class="btn btn-info">Erweiterte Ansicht</a>
          <br><br><br>
          <div id="content" class="table-responsive">
            <table class="table table-striped table-bordered data_table" cellspacing="0" width="100%">
              <thead>
              <tr class="success">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td><%= Grobengineering.device_anzahl(@subsubproject).round(2) %></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td><%= Grobengineering.funktion_sw(@subsubproject).round(2) %></td>
                <td></td>
                <td></td>
                <td></td>
                <td><%= Grobengineering.kabel_spez1_laenge(@subsubproject).round(2) %></td>
                <td></td>
                <td><%= Grobengineering.kabel_spez2_laenge(@subsubproject).round(2) %></td>
                <td></td>
                <td><%= Grobengineering.kabel_spez3_laenge(@subsubproject).round(2) %></td>
                <td></td>
                <td></td>
                <td><%= Grobengineering.leistung(@subsubproject).round(2) %></td>
                <td></td>
                <td><%= Grobengineering.strom_total(@subsubproject).round(2) %></td>
              </tr>
              <tr>
                <th rowspan="2">ID</th>
                <th rowspan="2">Offertposition</th>
                <th rowspan="2">Teilanlage</th>
                <th rowspan="2">Beschreibung</th>
                <th rowspan="2">Kommentar</th>
                <th rowspan="2">Gerät Import</th>
                <th rowspan="2">Gerät</th>
                <th rowspan="2">Geräte Anzahl</th>
                <th rowspan="2">Signale</th>
                <th rowspan="2">Schaltschrank für Preisberechnung</th>
                <th rowspan="2">Cluster/Schaltschrank zu IO-Gruppe</th>
                <th rowspan="2">IO-Gruppe</th>
                <th rowspan="2">Tag-Anlage</th>
                <th rowspan="2">Tag-Objekt</th>
                <th rowspan="2">Tag-Nummer</th>
                <th rowspan="2">Brake</th>
                <th rowspan="2">Klartext</th>
                <th rowspan="2">Bemerkung</th>
                <th rowspan="2">Funktion SW [h]</th>
                <th rowspan="2">Schaltanlagen Motorenabgang</th>
                <th rowspan="2">FU-Typ</th>
                <th colspan="6">Kabel Spezifisch</th>
                <th rowspan="2">Lieferant</th>
                <th rowspan="2">Spannung [V]</th>
                <th rowspan="2">Leistung [kW]</th>
                <th rowspan="2">Strom [A]</th>
                <th rowspan="2">Strom Total [A]</th>
                <th rowspan="2">Aktionen</th>
              </tr>
              <tr>
                <th>Kabel Spezifisch 1</th>
                <th>Kabel Spezifisch 1 Länge</th>
                <th>Kabel Spezifisch 2</th>
                <th>Kabel Spezifisch 2 Länge</th>
                <th>Kabel Spezifisch 3</th>
                <th>Kabel Spezifisch 3 Länge</th>
              </tr>
              </thead>
              <tbody>
              <% @grobengineerings.each_with_index do |grobengineering, i| %>
                  <tr>
                    <td><%= grobengineering.id %></td>
                    <td><%= grobengineering.offertposition.name %></td>
                    <td><%= grobengineering.subsystem.nil? ? '' : grobengineering.subsystem.name %></td>
                    <td><%= grobengineering.beschreibung %></td>
                    <td><%= grobengineering.kommentar %></td>
                    <td><%= grobengineering.device_import %></td>
                    <td><%= grobengineering.device.definition %></td>
                    <td><%= grobengineering.device_anzahl %></td>
                    <td>
                      <ul>
                        <% grobengineering.iosignals.each do |iosignal| %>
                          <li><%= iosignal.tagname %> </li>
                        <% end %>
                      </ul>
                    </td>
                    <td><%= grobengineering.schaltschrank_preisberechnung.nil? ? '' : grobengineering.schaltschrank_preisberechnung.name %></td>
                    <td><%= grobengineering.iogroup.nil? ? '' : grobengineering.iogroup.switchgearcombination.name %></td>
                    <td><%= grobengineering.iogroup.nil? ? '' : grobengineering.iogroup.name %></td>
                    <td><%= grobengineering.tag_anlage %></td>
                    <td><%= grobengineering.tag_objekt %></td>
                    <td><%= grobengineering.tag_nummer %></td>
                    <td><%= grobengineering.brake %></td>
                    <% if @subsubproject.subproject.max_zeichen_klartext_grobeng.to_i < grobengineering.klartext.length.to_i %>
                        <td class="danger"><%= grobengineering.klartext %></td>
                    <% else %>
                        <td><%= grobengineering.klartext %></td>
                    <% end %>
                    <td><%= grobengineering.bemerkung %></td>
                    <td><%= grobengineering.funktion_sw %></td>
                    <td><%= grobengineering.switchgear_motorenabgang.nil? ? '' : grobengineering.switchgear_motorenabgang.kennung %></td>
                    <td><%= grobengineering.fu_typ.nil? ? '' : grobengineering.fu_typ.kennung %></td>
                    <td><%= grobengineering.wire_spez1.nil? ? '' : grobengineering.wire_spez1.kabeltyp %></td>
                    <td><%= grobengineering.kabel_spez1_laenge %></td>
                    <td><%= grobengineering.wire_spez2.nil? ? '' : grobengineering.wire_spez2.kabeltyp %></td>
                    <td><%= grobengineering.kabel_spez2_laenge %></td>
                    <td><%= grobengineering.wire_spez3.nil? ? '' : grobengineering.wire_spez3.kabeltyp %></td>
                    <td><%= grobengineering.kabel_spez3_laenge %></td>
                    <td><%= grobengineering.lieferant %></td>
                    <td><%= grobengineering.spannung %></td>
                    <td><%= grobengineering.leistung %></td>
                    <td><%= grobengineering.strom %></td>
                    <td><%= grobengineering.strom_total %></td>
                    <td>
                      <a href="<%= project_subproject_subsubproject_grobengineering_path(@project.id, @subproject.id, @subsubproject.id, grobengineering.id) %>" class="btn btn-xs btn-default btn-index">Info</a>
                      <a href="<%= edit_project_subproject_subsubproject_grobengineering_path(@project.id, @subproject.id, @subsubproject.id, grobengineering.id) %>" class="btn btn-xs btn-info btn-index">Bearbeiten</a>
                      <a href="<%= new_project_subproject_subsubproject_grobengineering_iosignal_path(@project.id, @subproject.id, @subsubproject.id, grobengineering.id) %>" class="btn btn-xs btn-success btn-index">Neues Signal erstellen</a>
                      <button type="button" class="btn btn-xs btn-danger btn-index"
                              data-toggle="modal" data-target="#popup_sure_delete"
                              data-itemid="<%= grobengineering.id %>"
                              data-model="grobengineerings">
                        Eintrag löschen
                      </button>
                    </td>
                  </tr>
              <% end %>
              </tbody>
            </table>
          </div>

          <%= render 'layouts/popups' %>
          <%= render 'layouts/loading', :message => "Lade..." %>

          <script type="text/javascript">
              function confirm_click()
              {
                  return confirm("Sind Sie sicher, alle Grobengineering-Einträge dieser Version zu löschen?");
              }
          </script>
      <% else %>
          <div class="alert alert-danger">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
            Mindestens 1 Offertposition muss zu dieser Version existieren.<br>
            <a href="<%= new_project_subproject_subsubproject_offertposition_path %>">Erstellen</a>
          </div>
      <% end %>
  <% else %>
      <div class="alert alert-danger">
        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
        Mindestens 1 Gerät muss in der Datenbank existieren.
      </div>
  <% end %>
<% else %>
<div class="alert alert-danger">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  Bitte prüfen, ob folgende IO-Baugruppen in Datenbank mit folgender Kennung existieren:
  <ul>
    <li>PB-Stecker</li>
    <li>ET200SP PB</li>
    <li>ET200SP 08DI</li>
    <li>ET200SP 16DI</li>
    <li>ET200SP 08DO</li>
    <li>ET200SP 16DO</li>
    <li>ET200SP 02AI</li>
    <li>ET200SP 02AO</li>
    <li>ET200SP Enc INKR</li>
    <li>ET200SP Enc SSI</li>
    <li>ET200SP Base mit U-Vers</li>
    <li>ET200SP Base</li>
    <li>PNOZmulti</li>
    <li>PNOZmulti Chipcard</li>
    <li>PNOZmulti Klemm</li>
    <li>PNOZmulti SL</li>
    <li>PNOZmulti SL Klemm</li>
    <li>PNOZmulti PB</li>
    <li>PNOZmulti 08DI</li>
    <li>PNOZmulti 04DO</li>
    <li>PNOZmulti 01AI</li>
    <li>PNOZmulti 01AO</li>
  </ul>
</div>
<% end %>

<%= link_to "Zurück zu Projekt", project_subproject_path(@project.id, @subproject.id) %>